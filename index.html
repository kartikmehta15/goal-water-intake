<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Intake Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="auth.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <h1>üíß Water Intake Tracker</h1>
                </div>
                <div class="user-profile" id="user-profile">
                    <div class="user-info">
                        <span class="user-icon">üë§</span>
                        <span class="user-email" id="user-email"></span>
                    </div>
                    <button class="logout-btn" id="logout-btn">Logout</button>
                </div>
            </div>
            
            <!-- Tab Navigation -->
            <nav class="tab-navigation">
                <button class="tab-btn active" data-tab="today">
                    <span class="tab-icon">üìä</span>
                    <span class="tab-label">Today</span>
                </button>
                <button class="tab-btn" data-tab="calendar">
                    <span class="tab-icon">üìÖ</span>
                    <span class="tab-label">Calendar</span>
                </button>
                <button class="tab-btn" data-tab="stats">
                    <span class="tab-icon">üìà</span>
                    <span class="tab-label">Statistics</span>
                </button>
                <button class="tab-btn" data-tab="export">
                    <span class="tab-icon">üíæ</span>
                    <span class="tab-label">Export</span>
                </button>
                <button class="tab-btn" data-tab="settings">
                    <span class="tab-icon">‚öôÔ∏è</span>
                    <span class="tab-label">Settings</span>
                </button>
            </nav>
        </header>

        <div class="main-content">
            <!-- Tab 1: Today -->
            <section class="tab-content active" id="tab-today">
                <div class="today-layout">
                    <!-- Compact Info Box (top-right) -->
                    <div class="info-box">
                        <div class="info-item">
                            <span class="info-label">Current</span>
                            <span class="info-value"><span id="current-intake">0</span>ml</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Goal</span>
                            <span class="info-value"><span id="goal-display">2000</span>ml</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Left</span>
                            <span class="info-value"><span id="remaining-intake">2000</span>ml</span>
                        </div>
                    </div>
                    
                    <div class="today-main">
                        <div class="date-selector">
                            <label for="selected-date">Date:</label>
                            <input type="date" id="selected-date" />
                        </div>
                        
                        <div class="visual-container">
                            <div class="creature-name" id="creature-name"></div>
                            <div class="creature-display" id="creature-display"></div>
                        </div>
                        
                        <div class="circular-progress">
                            <svg class="progress-ring" width="120" height="120">
                                <defs>
                                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#4A90E2;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#50C878;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle class="progress-ring-circle-bg" cx="60" cy="60" r="52" />
                                <circle class="progress-ring-circle" cx="60" cy="60" r="52" id="progress-circle" />
                            </svg>
                            <div class="progress-text">
                                <div class="progress-percentage" id="percentage-display">0%</div>
                                <div class="progress-label">of goal</div>
                            </div>
                        </div>
                        
                        <!-- Quick Add Buttons -->
                        <div class="quick-add-buttons">
                            <button class="quick-add-btn" data-amount="250">+250ml</button>
                            <button class="quick-add-btn" data-amount="500">+500ml</button>
                            <button class="quick-add-btn" data-amount="1000">+1L</button>
                            <button class="quick-add-btn custom" id="show-custom-btn">Custom</button>
                        </div>
                        
                        <!-- Custom Input (initially hidden) -->
                        <div class="custom-input-container" id="custom-input-container" style="display: none;">
                            <div class="intake-input">
                                <label for="water-amount">Custom Amount (ml):</label>
                                <input type="number" id="water-amount" value="0" min="0" step="50" />
                                <button id="save-btn" class="btn-primary">Save</button>
                            </div>
                        </div>
                        
                        <div class="goal-setting">
                            <label for="daily-goal">Daily Goal (ml):</label>
                            <input type="number" id="daily-goal" value="2000" min="500" max="10000" step="100" />
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Tab 2: Calendar (FULL WIDTH) -->
            <section class="tab-content" id="tab-calendar">
                <div class="calendar-header">
                    <h2>Monthly Overview</h2>
                </div>
                <div class="calendar-controls">
                    <button id="prev-month" class="btn-secondary">‚Üê Previous</button>
                    <h3 id="current-month"></h3>
                    <button id="next-month" class="btn-secondary">Next ‚Üí</button>
                </div>
                <div id="calendar-grid" class="calendar-grid calendar-fullwidth"></div>
                <div class="calendar-footer">
                    <div class="calendar-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #28a745;"></span> 100%+</span>
                        <span class="legend-item"><span class="legend-color" style="background: #90ee90;"></span> 75-99%</span>
                        <span class="legend-item"><span class="legend-color" style="background: #ffc107;"></span> 50-74%</span>
                        <span class="legend-item"><span class="legend-color" style="background: #ffeb99;"></span> 25-49%</span>
                        <span class="legend-item"><span class="legend-color" style="background: #ffcccb;"></span> &lt;25%</span>
                    </div>
                    <div class="month-summary" id="month-summary">
                        <strong>This Month:</strong> <span id="month-total-days">0</span> days tracked | 
                        <span id="month-goal-met">0</span> days goal met
                    </div>
                </div>
            </section>
            
            <!-- Tab 3: Statistics -->
            <section class="tab-content" id="tab-stats">
                <h2>üìä Summary Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card stat-excellent">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-value" id="stat-100">0</div>
                        <div class="stat-label">100%+ Goal Met</div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" id="bar-100" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card stat-good">
                        <div class="stat-icon">üí™</div>
                        <div class="stat-value" id="stat-75">0</div>
                        <div class="stat-label">75-99% Goal</div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" id="bar-75" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card stat-moderate">
                        <div class="stat-icon">üåä</div>
                        <div class="stat-value" id="stat-50">0</div>
                        <div class="stat-label">50-74% Goal</div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" id="bar-50" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card stat-low">
                        <div class="stat-icon">üíß</div>
                        <div class="stat-value" id="stat-25">0</div>
                        <div class="stat-label">25-49% Goal</div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" id="bar-25" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card stat-minimal">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-value" id="stat-0">0</div>
                        <div class="stat-label">Below 25%</div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" id="bar-0" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="stats-summary">
                    <div class="streak-counter" id="streak-counter">
                        üî• <span id="current-streak">0</span> day streak
                    </div>
                    <div class="total-days">
                        Total tracked: <span id="total-tracked-days">0</span> days
                    </div>
                </div>
            </section>
            
            <!-- Tab 4: Export -->
            <section class="tab-content" id="tab-export">
                <h2>Export Your Data</h2>
                <div class="export-controls">
                    <div class="date-range">
                        <div class="date-input-group">
                            <label for="export-start-date">Start Date:</label>
                            <input type="date" id="export-start-date" />
                        </div>
                        <div class="date-input-group">
                            <label for="export-end-date">End Date:</label>
                            <input type="date" id="export-end-date" />
                        </div>
                    </div>
                    <button id="download-csv-btn" class="btn-primary">üì• Download CSV</button>
                </div>
            </section>
            
            <!-- Tab 5: Settings -->
            <section class="tab-content" id="tab-settings">
                <h2>‚öôÔ∏è Settings</h2>
                
                <!-- Power User Unlock Section -->
                <div id="power-user-lock" class="power-user-unlock" style="display: none;">
                    <h3>üîí Email Notifications (Power Users Only)</h3>
                    <p>Enter the access code to unlock email notification features</p>
                    <div class="unlock-form">
                        <input type="text" id="power-user-code-input" class="unlock-input" placeholder="Enter access code" />
                        <button id="unlock-power-user-btn" class="unlock-btn">üîì Unlock</button>
                    </div>
                    <div id="unlock-message" class="unlock-message" style="display: none;"></div>
                </div>

                <!-- Power User Unlocked Badge -->
                <div id="power-user-unlocked" class="power-user-unlocked" style="display: none;">
                    <h3>‚úÖ Power User Unlocked</h3>
                    <p>Email notifications are enabled for your account</p>
                </div>
                
                <div class="settings-card" id="email-settings-card" style="display: none;">
                    <h3>üìß Email Notifications</h3>
                    <p class="settings-description">Receive email reminders to stay hydrated throughout the day</p>
                    
                    <div class="setting-item">
                        <div class="setting-header">
                            <label class="switch">
                                <input type="checkbox" id="email-notifications-enabled">
                                <span class="slider"></span>
                            </label>
                            <span class="setting-label">Enable Email Reminders</span>
                        </div>
                    </div>

                    <div id="notification-settings" class="notification-settings" style="display: none;">
                        <div class="setting-item">
                            <label class="setting-label">Reminder Times (Up to 5 Custom Reminders)</label>
                            
                            <!-- Reminder Slot 1 -->
                            <div class="reminder-slot" id="reminder-slot-1">
                                <div class="reminder-header">
                                    <h4>Reminder 1</h4>
                                    <div class="reminder-enable">
                                        <input type="checkbox" id="reminder-1-enabled" checked>
                                        <label for="reminder-1-enabled">Enabled</label>
                                    </div>
                                </div>
                                <div class="reminder-time-options">
                                    <label>Time:</label>
                                    <select id="reminder-1-preset" class="time-preset-select">
                                        <option value="">-- Select Preset --</option>
                                        <option value="07:00">7:00 AM</option>
                                        <option value="09:00" selected>9:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="12:00">12:00 PM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00">3:00 PM</option>
                                        <option value="17:00">5:00 PM</option>
                                        <option value="19:00">7:00 PM</option>
                                        <option value="21:00">9:00 PM</option>
                                        <option value="custom">Custom Time</option>
                                    </select>
                                    <span class="time-divider">or</span>
                                    <input type="time" id="reminder-1-custom" class="custom-time-input" disabled />
                                </div>
                            </div>

                            <!-- Reminder Slot 2 -->
                            <div class="reminder-slot" id="reminder-slot-2">
                                <div class="reminder-header">
                                    <h4>Reminder 2</h4>
                                    <div class="reminder-enable">
                                        <input type="checkbox" id="reminder-2-enabled" checked>
                                        <label for="reminder-2-enabled">Enabled</label>
                                    </div>
                                </div>
                                <div class="reminder-time-options">
                                    <label>Time:</label>
                                    <select id="reminder-2-preset" class="time-preset-select">
                                        <option value="">-- Select Preset --</option>
                                        <option value="07:00">7:00 AM</option>
                                        <option value="09:00">9:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="12:00">12:00 PM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00" selected>3:00 PM</option>
                                        <option value="17:00">5:00 PM</option>
                                        <option value="19:00">7:00 PM</option>
                                        <option value="21:00">9:00 PM</option>
                                        <option value="custom">Custom Time</option>
                                    </select>
                                    <span class="time-divider">or</span>
                                    <input type="time" id="reminder-2-custom" class="custom-time-input" disabled />
                                </div>
                            </div>

                            <!-- Reminder Slot 3 -->
                            <div class="reminder-slot" id="reminder-slot-3">
                                <div class="reminder-header">
                                    <h4>Reminder 3</h4>
                                    <div class="reminder-enable">
                                        <input type="checkbox" id="reminder-3-enabled" checked>
                                        <label for="reminder-3-enabled">Enabled</label>
                                    </div>
                                </div>
                                <div class="reminder-time-options">
                                    <label>Time:</label>
                                    <select id="reminder-3-preset" class="time-preset-select">
                                        <option value="">-- Select Preset --</option>
                                        <option value="07:00">7:00 AM</option>
                                        <option value="09:00">9:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="12:00">12:00 PM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00">3:00 PM</option>
                                        <option value="17:00">5:00 PM</option>
                                        <option value="19:00" selected>7:00 PM</option>
                                        <option value="21:00">9:00 PM</option>
                                        <option value="custom">Custom Time</option>
                                    </select>
                                    <span class="time-divider">or</span>
                                    <input type="time" id="reminder-3-custom" class="custom-time-input" disabled />
                                </div>
                            </div>

                            <!-- Reminder Slot 4 -->
                            <div class="reminder-slot disabled" id="reminder-slot-4">
                                <div class="reminder-header">
                                    <h4>Reminder 4</h4>
                                    <div class="reminder-enable">
                                        <input type="checkbox" id="reminder-4-enabled">
                                        <label for="reminder-4-enabled">Enabled</label>
                                    </div>
                                </div>
                                <div class="reminder-time-options">
                                    <label>Time:</label>
                                    <select id="reminder-4-preset" class="time-preset-select" disabled>
                                        <option value="">-- Select Preset --</option>
                                        <option value="07:00">7:00 AM</option>
                                        <option value="09:00">9:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="12:00" selected>12:00 PM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00">3:00 PM</option>
                                        <option value="17:00">5:00 PM</option>
                                        <option value="19:00">7:00 PM</option>
                                        <option value="21:00">9:00 PM</option>
                                        <option value="custom">Custom Time</option>
                                    </select>
                                    <span class="time-divider">or</span>
                                    <input type="time" id="reminder-4-custom" class="custom-time-input" disabled />
                                </div>
                            </div>

                            <!-- Reminder Slot 5 -->
                            <div class="reminder-slot disabled" id="reminder-slot-5">
                                <div class="reminder-header">
                                    <h4>Reminder 5</h4>
                                    <div class="reminder-enable">
                                        <input type="checkbox" id="reminder-5-enabled">
                                        <label for="reminder-5-enabled">Enabled</label>
                                    </div>
                                </div>
                                <div class="reminder-time-options">
                                    <label>Time:</label>
                                    <select id="reminder-5-preset" class="time-preset-select" disabled>
                                        <option value="">-- Select Preset --</option>
                                        <option value="07:00">7:00 AM</option>
                                        <option value="09:00">9:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="12:00">12:00 PM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00">3:00 PM</option>
                                        <option value="17:00">5:00 PM</option>
                                        <option value="19:00">7:00 PM</option>
                                        <option value="21:00" selected>9:00 PM</option>
                                        <option value="custom">Custom Time</option>
                                    </select>
                                    <span class="time-divider">or</span>
                                    <input type="time" id="reminder-5-custom" class="custom-time-input" disabled />
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label for="user-timezone" class="setting-label">Your Timezone</label>
                            <select id="user-timezone" class="timezone-select">
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>

                        <button id="save-settings-btn" class="btn-primary">üíæ Save Settings</button>
                    </div>
                    
                    <!-- Test Email Section -->
                    <div class="settings-group" style="margin-top: 30px;">
                        <h3>üß™ Test Email Delivery</h3>
                        <p class="settings-description">Send a test reminder email to verify your setup is working correctly</p>
                        
                        <div class="test-email-info">
                            <p>Test email will be sent to: <strong id="test-email-address"></strong></p>
                            <p class="test-note">The email will show your current progress and include a link to the website.</p>
                        </div>
                        
                        <button id="send-test-email-btn" class="btn-secondary">
                            üì® Send Test Email Now
                        </button>
                        <div class="test-message" id="test-message"></div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>üë§ Account Settings</h3>
                    <div class="setting-item">
                        <label class="setting-label">Email Address</label>
                        <p class="user-email-display" id="settings-user-email"></p>
                    </div>
                    <div class="setting-item">
                        <label for="daily-goal-setting" class="setting-label">Default Daily Goal (ml)</label>
                        <input type="number" id="daily-goal-setting" class="goal-input" value="2000" min="500" max="10000" step="100">
                    </div>
                    <button id="save-account-settings-btn" class="btn-primary">üíæ Save Account Settings</button>
                </div>
            </section>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">Syncing data...</p>
    </div>

    <!-- Offline Message -->
    <div class="offline-message" id="offline-message">
        <span class="offline-icon">üì°</span>
        <span>You are offline. Changes will sync when you're back online.</span>
    </div>

    <!-- Toast Notification -->
    <div class="toast-notification" id="toast-notification">
        <span class="toast-icon" id="toast-icon"></span>
        <div class="toast-content">
            <div class="toast-title" id="toast-title"></div>
            <div class="toast-message" id="toast-message"></div>
        </div>
        <button class="toast-close" id="toast-close" aria-label="Close">√ó</button>
    </div>

    <script src="auth.js"></script>
    <script src="script.js"></script>
</body>
</html>
